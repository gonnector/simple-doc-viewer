# Simple Doc Viewer — PRD

**작성일**: 2026-02-22
**프로젝트 경로**: `E:\project\simple-doc-viewer`

---

## 1. 프로젝트 개요

VS Code 같은 무거운 에디터 없이 로컬 파일시스템의 텍스트 파일과 마크다운 문서를 빠르게 탐색하고 열람할 수 있는 **경량 로컬 문서 뷰어**.

### 핵심 가치

- **가볍다**: 단일 `server.js` 파일, npm 의존성 0개 (Node.js 내장 모듈만 사용)
- **오프라인**: `localhost`에서만 동작, 외부 네트워크 불필요
- **즉시 사용**: `node server.js` 한 줄로 실행

### 사용 시나리오

```
사용자: node server.js
서버: Doc Viewer running at http://localhost:3000
사용자: 브라우저에서 접속 → 파일 탐색 → 마크다운 읽기
```

---

## 2. 아키텍처

### 구조

```
simple-doc-viewer/
  server.js          ← 단일 파일 (Node.js 내장 모듈만 사용, npm 의존성 0개)
  lib/
    mermaid.min.js   ← 첫 실행 시 자동 다운로드 (이후 오프라인 동작)
  PRD.md             ← 이 문서
```

### 통신 흐름

```
브라우저 (localhost:3000)  ←→  Node.js HTTP 서버 (같은 PC)  ←→  로컬 파일시스템
```

- 외부 인터넷 불필요 (완전 오프라인, 단 mermaid.js 최초 다운로드 시 1회 필요)
- 외부에서 접근 불가 (127.0.0.1 바인딩)

---

## 3. 서버 설계

### 기술 스택

- **런타임**: Node.js (버전 18+)
- **의존성**: 없음 (`http`, `fs`, `path`, `url`, `https` — 모두 Node.js 내장)
- **포트**: 3000 (기본값, 커맨드라인 인자로 변경 가능)

### API 엔드포인트

| Method | Endpoint | 파라미터 | 응답 | 설명 |
|--------|----------|---------|------|------|
| GET | `/` | — | HTML | 프론트엔드 SPA 서빙 |
| GET | `/api/list` | `path` (디렉토리 경로) | JSON | 디렉토리 목록 |
| GET | `/api/read` | `path` (파일 경로) | JSON | 파일 내용 읽기 |
| GET | `/lib/mermaid.min.js` | — | JS | Mermaid 라이브러리 서빙 |

### `/api/list` 응답 형식

```json
{
  "path": "C:/Users/Pro/cc-general",
  "parent": "C:/Users/Pro",
  "items": [
    { "name": ".claude", "type": "dir", "modified": "2026-02-22T10:49:00Z" },
    { "name": "markdown-test.md", "type": "file", "size": 3969, "modified": "2026-02-22T12:18:00Z" }
  ]
}
```

### `/api/read` 응답 형식

```json
{
  "path": "C:/Users/Pro/cc-general/markdown-test.md",
  "name": "markdown-test.md",
  "ext": "md",
  "size": 3969,
  "content": "# 마크다운 렌더링 테스트\n\n..."
}
```

### 보안 요구사항

1. **localhost 전용**: `127.0.0.1`에만 바인딩 (외부 접근 차단)
2. **경로 순회 방지**: `../` 등을 이용한 경로 탈출 차단 (path.resolve 후 검증)
3. **바이너리 파일 보호**: 텍스트가 아닌 파일은 읽기 거부 (Content sniffing 또는 확장자 기반)
4. **대용량 파일 제한**: 일정 크기(예: 1MB) 이상은 읽기 거부, 안내 메시지 반환

### Mermaid 자동 다운로드

- 서버 시작 시 `lib/mermaid.min.js` 존재 여부 확인
- 없으면 CDN에서 자동 다운로드하여 `lib/` 에 저장 (~2MB)
- 다운로드 실패 시 경고 출력 후 서버는 정상 시작 (mermaid 렌더링만 비활성화)
- 이후 로컬 파일에서 서빙 → 완전 오프라인 동작

---

## 4. 프론트엔드 설계

### 기본 원칙

- **단일 HTML**: `server.js`가 응답 본문으로 직접 서빙 (별도 파일 없음)
- **외부 CDN 없음**: 모든 CSS/JS 인라인 (mermaid만 로컬 서빙)
- **다크 테마**: VS Code 스타일의 어두운 UI

### 레이아웃

```
+-----------------------------------------------------------+
|  [Doc Viewer]  경로 표시  [설정 토글]                       |
+---------------+-------------------------------------------+
|               |  [탭1] [탭2] [탭3]                [×]     |
|  파일 트리     |-------------------------------------------|
|               |                                           |
|  📁 parent    |  파일 내용 영역                             |
|  📁 folder1   |                                           |
|  📁 folder2   |  - 마크다운: 렌더링된 뷰                    |
|  📄 file.md   |  - 텍스트/코드: 라인번호 + 구문강조           |
|  📄 file.json |  - Mermaid: 다이어그램 렌더링               |
|               |                                           |
+---------------+-------------------------------------------+
```

### 파일 트리 (왼쪽 사이드바)

1. **폴더 자유 탐색**: 클릭으로 하위 폴더 진입
2. **상위 이동**: 맨 위에 `📁 ..` (부모 디렉토리) 항상 표시
3. **파일 아이콘**: 확장자별 아이콘/색상 구분
4. **정렬**: 폴더 먼저 → 파일 (이름 알파벳순)
5. **검색/필터**: 현재 디렉토리 내 파일명 필터링
6. **숨김 파일 토글**: `.git`, `node_modules` 등 숨김/표시 전환 버튼

### 파일 뷰어 (오른쪽 콘텐츠 영역)

#### 마크다운 렌더링 (.md)

지원 요소:
- 제목 (h1~h6), 단락, 굵게/기울임/취소선
- 순서 목록, 비순서 목록, 체크리스트
- 코드 블록 (언어별 구문 강조), 인라인 코드
- 테이블 (정렬 지원)
- 인용문 (중첩)
- 링크, 이미지
- 수평선
- `<details>/<summary>` (접기/펼치기)
- `<kbd>` 태그
- **Mermaid 코드 블록** → 다이어그램으로 렌더링

#### Mermaid 렌더링

마크다운 내 ` ```mermaid ` 코드 블록을 자동 감지하여 다이어그램으로 렌더링:

```markdown
    ```mermaid
    graph TD
      A[Start] --> B{Decision}
      B -->|Yes| C[OK]
      B -->|No| D[Cancel]
    ```
```

- `lib/mermaid.min.js`가 로드된 경우에만 렌더링
- 로드 실패 시 코드 블록을 그대로 텍스트로 표시 (graceful degradation)

#### 텍스트/코드 뷰 (.txt, .json, .js, .ts, .yaml, .toml, .cfg, .env, .gitignore 등)

- 라인 번호 표시
- 확장자 기반 기본 구문 강조:
  - JavaScript/TypeScript: 키워드, 문자열, 주석, 숫자
  - JSON: 키, 값, 문자열
  - YAML: 키, 주석
  - Dockerfile: 지시어, 주석
- 텍스트 줄 바꿈 토글

#### 지원하지 않는 파일

- 바이너리 파일 (.png, .exe, .zip 등): "미리보기 불가" 안내
- 너무 큰 파일 (>1MB): "파일이 너무 큽니다" 안내

### 탭 시스템

- 파일 클릭 시 새 탭으로 열기
- 탭 닫기 (×) 버튼
- 활성 탭 하이라이트
- 탭 클릭으로 전환

### 사용자 설정 (토글 버튼)

| 설정 | 기본값 | 설명 |
|------|-------|------|
| 숨김 파일 표시 | OFF | `.git`, `node_modules` 등 표시 여부 |
| 줄 바꿈 | OFF | 긴 줄 자동 줄 바꿈 |

---

## 5. 실행 방법

### 기본 실행

```bash
node server.js
```

→ 현재 디렉토리를 루트로 `http://localhost:3000` 에서 서비스

### 옵션

```bash
node server.js [옵션]

옵션:
  --port, -p <number>    포트 번호 (기본: 3000)
  --root, -r <path>      탐색 루트 디렉토리 (기본: 현재 디렉토리)
  --no-hidden            숨김 파일 기본 비표시
```

### 사용 예시

```bash
# 특정 프로젝트 폴더를 뷰어로 열기
node server.js --root C:\Users\Pro\my-project

# 포트 변경
node server.js --port 8080

# 아무 위치에서나 실행 (현재 디렉토리 기준)
cd E:\docs && node E:\project\simple-doc-viewer\server.js
```

---

## 6. 비기능 요구사항

1. **성능**: 디렉토리 목록 응답 < 100ms, 파일 읽기 < 200ms
2. **호환성**: Windows (MSYS/Git Bash), macOS, Linux
3. **파일 크기**: `server.js` 단일 파일 (프론트엔드 HTML 내장)
4. **의존성**: Node.js 18+ 외 없음 (npm install 불필요)

---

## 7. 범위 외 (의도적으로 제외)

- 파일 편집/저장 기능
- 파일 생성/삭제/이름변경
- Git 통합
- 터미널 기능
- 다중 사용자/인증
- HTTPS
- 파일 업로드
- 이미지 미리보기

---

## 8. 기술 결정 사항 요약

| 결정 | 선택 | 이유 |
|------|------|------|
| 서버 프레임워크 | Node.js 내장 `http` | npm 의존성 제로 |
| 프론트엔드 번들링 | 없음 (인라인) | 단일 파일 유지 |
| 마크다운 파서 | 커스텀 경량 파서 | 외부 라이브러리 불필요 |
| Mermaid | 자동 다운로드 후 로컬 서빙 | 최초 1회만 네트워크, 이후 오프라인 |
| 구문 강조 | 커스텀 경량 하이라이터 | 외부 라이브러리 불필요 |
| 테마 | 다크 모드 고정 | VS Code 대체 용도, 눈 편안함 |

---

## 9. 참고 자료: 정적 프로토타입 (`reference/`)

본 프로젝트에 앞서 정적 HTML 프로토타입을 먼저 제작하여 마크다운 렌더링과 UI 레이아웃을 검증했다. 해당 파일들은 `reference/` 폴더에 보관되어 있다.

### 파일 목록

| 파일 | 설명 |
|------|------|
| `reference/markdown-test.md` | 12가지 마크다운 요소를 포함한 테스트 파일 (제목, 목록, 테이블, 코드블록, 인용문, 체크리스트, 각주, 이모지, details/summary 등) |
| `reference/markdown-viewer.html` | 위 마크다운을 렌더링하는 단일 HTML 파일. 커스텀 경량 마크다운 파서와 구문 강조를 순수 JS로 구현. CDN 의존성 없음, 다크/라이트 모드 자동 전환 |
| `reference/doc-explorer.html` | 파일 트리 + 탭 시스템 + 마크다운/코드 뷰어를 갖춘 Playground 스타일 정적 문서 탐색기. 파일 내용을 HTML에 임베딩하는 방식 |

### 제작 과정에서 사용한 Claude Code 스킬

1. **playground** — `doc-explorer.html` 제작에 사용. 인터랙티브한 컨트롤 + 라이브 프리뷰 + 프롬프트 출력을 갖춘 단일 HTML 파일 생성 패턴
2. **brainstorming** — 프로젝트 아이디어를 구체화하고 아키텍처 설계를 도출하는 과정에 사용

### 프로토타입에서 얻은 교훈

- **`<script type="text/plain" data-file="...">`**: 마크다운 등 대용량 텍스트를 HTML에 안전하게 임베딩하는 패턴. 브라우저가 실행하지 않으면서 `.textContent`로 원본 추출 가능
- **커스텀 마크다운 파서**: 외부 라이브러리(marked.js 등) 없이 순수 JS로 충분히 구현 가능. 본 프로젝트의 프론트엔드 마크다운 렌더러 기반으로 활용
- **정적 파일의 한계**: 브라우저 보안 정책상 로컬 파일시스템 접근 불가 → 동적 폴더 탐색을 위해 로컬 서버가 필요하다는 결론 도출
