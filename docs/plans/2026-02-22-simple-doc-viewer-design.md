# Simple Doc Viewer — 설계 문서

**작성일**: 2026-02-22
**상태**: 승인됨

---

## 1. 설계 결정 요약

### 개발 접근법: 점진적 강화 (Progressive Enhancement)

3가지 접근법을 비교 분석한 결과, **점진적 강화** 방식을 채택했다.

| 접근법 | 장점 | 단점 | 판정 |
|--------|------|------|------|
| A. 일괄 구축 | 빠름 | 디버깅 난해, 중간 검증 불가 | 탈락 |
| B. 컴포넌트 분리 후 조립 | 독립 테스트 가능 | PRD "단일 파일" 요구와 상충 | 탈락 |
| **C. 점진적 강화** | **매 단계 검증, 안전** | A보다 약간 느림 | **채택** |

**채택 이유**: reference 프로토타입에 검증된 코드가 있으므로 단계별로 통합하며 실제 브라우저에서 확인하는 것이 가장 안정적이다.

---

## 2. server.js 파일 내부 구조

```
server.js (~2000-2500줄)
├─ [1] 설정 & 상수        (~30줄)
├─ [2] 유틸리티 함수       (~50줄)
├─ [3] Mermaid 다운로더    (~40줄)
├─ [4] API 핸들러          (~120줄)
├─ [5] HTML 프론트엔드     (~1800줄)
│   ├─ CSS                (~400줄)
│   ├─ 마크다운 파서       (~350줄)
│   ├─ 구문 강조기         (~150줄)
│   ├─ 파일 트리           (~200줄)
│   ├─ 탭 시스템           (~150줄)
│   ├─ 뷰어 컴포넌트       (~200줄)
│   └─ 앱 초기화           (~100줄)
└─ [6] 서버 시작           (~30줄)
```

---

## 3. 5단계 구현 Phase

### Phase 1 — 기본 골격
- HTTP 서버 + `/api/list` + 최소 UI (2컬럼 레이아웃, 폴더 탐색)
- 커맨드라인 인자 (`--port`, `--root`)

### Phase 2 — 파일 읽기 + 파일 트리 완성
- `/api/read` + 보안 (경로 순회 방지, 바이너리 거부, 1MB 제한)
- 확장자별 아이콘/색상, 정렬, 검색/필터

### Phase 3 — 마크다운 렌더링
- reference/markdown-viewer.html의 md.parse() 통합
- 12가지 마크다운 요소 지원

### Phase 4 — 구문 강조 + 탭 시스템
- JS/TS, JSON, YAML, Dockerfile 구문 강조
- 탭 열기/닫기/전환

### Phase 5 — Mermaid + 설정 + 마무리
- Mermaid 자동 다운로드 및 렌더링
- 숨김 파일/줄 바꿈 토글

---

## 4. 보안 설계

| 위협 | 대응 |
|------|------|
| 경로 순회 | path.resolve() 후 루트 하위 검증 |
| 바이너리 파일 | 확장자 화이트리스트 |
| 대용량 파일 | 1MB 초과 거부 |
| 외부 접근 | 127.0.0.1 바인딩 |
| XSS | HTML 이스케이프 처리 |

---

## 5. 활용 스킬 파이프라인

| 순서 | 스킬 | 용도 |
|------|------|------|
| 1 | brainstorming | 설계 확정 |
| 2 | writing-plans | 구현 계획 수립 |
| 3 | frontend-design | Phase별 UI 구현 |
| 4 | verification-before-completion | Phase 완료 검증 |
| 5 | requesting-code-review | 최종 코드 리뷰 |

---

## 6. 참고 자료

- `PRD.md` — 제품 요구사항 정의
- `reference/markdown-viewer.html` — 마크다운 파서 원본 (760줄)
- `reference/doc-explorer.html` — 파일 탐색기 프로토타입 (1587줄)
- `reference/markdown-test.md` — 마크다운 렌더링 테스트 데이터
